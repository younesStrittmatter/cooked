<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Grid Game</title>
</head>
<body>
<canvas id="scene" width="512" height="512" style="background: black"></canvas>
<script type="module" src="/engine/static/engine_ui.js"></script>

<script type="module">
    import {renderScene} from "/extension/static0/renderer_ui.js";
    import {sendIntent, fetchState} from "/engine/static/engine_ui.js";

    let canvas = document.getElementById("scene");

    canvas.addEventListener("click", async (event) => {
        const state = await fetchState();
        const rect = canvas.getBoundingClientRect();
        const clickX = event.clientX - rect.left;
        const clickY = event.clientY - rect.top;


        const objects = state['gameObjects'] || [];

        for (const obj of objects) {


            if (obj.isClickable) {
                const withinX = clickX >= obj.x && clickX <= obj.x + obj.w;
                const withinY = clickY >= obj.y && clickY <= obj.y + obj.h;

                if (withinX && withinY) {
                    console.log("Clicked on", obj.id);
                    await sendIntent({type: "click", target: obj.id});
                    return;
                }
            }
        }
    });

    async function update() {
        const state = await fetchState();
        await renderScene(state);
    }

    setInterval(update, 200);
    update()
</script>
</body>
</html>
